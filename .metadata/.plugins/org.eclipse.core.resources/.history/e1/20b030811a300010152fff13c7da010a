/*
 * flash_interface.c
 *
 *  Created on: May 13, 2025
 *      Author: axeel
 */

#include "flash_interface.h"

bool flash_write_double_word(uint32_t addr, void* data){

	//PICK DOUBLE WORD WRITING
	FLASH->CR |= FLASH_CR_PSIZE_0 | FLASH_CR_PSIZE_1;
	//CHECK IF BUSY
	if(FLASH->SR & FLASH_SR_BSY) return false;
	__disable_irq();

	//ENABLE PROGRAMMING MODE
	FLASH->CR |= FLASH_CR_PG;
	//UNLOCK FLASH
	FLASH->KEYR = 0x45670123;
	FLASH->KEYR = 0xCDEF89AB;

	//WRITE
	*(uint64_t *)addr = *(uint64_t *)data;

	//WAIT TILL COMPLETES
	while(FLASH->SR & FLASH_SR_BSY) ;
	FLASH->CR |= FLASH_CR_LOCK;
	__enable_irq();
	//TURN OFF PROGRAMMING MODE
	FLASH->CR &= ~FLASH_CR_PG;

	return true;
}



void flash_read_double_word(uint32_t addr, void* data){



}
